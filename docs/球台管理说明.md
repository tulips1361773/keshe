# 🏓 球台管理说明

## 问题诊断

### 原因分析
用户遇到的"该时间段暂无可用球台，请调整时间"问题的根本原因是：
- **中心校区没有球台数据**：用户选择的校区中没有创建任何球台
- **球台数据分布不均**：只有部分校区有球台，其他校区为空

### 解决方案
已为所有校区添加了球台数据：
- 中心校区：5个球台 (C01-C05)
- 主校区：5个球台 (T01-T05)
- 测试校区：2个球台
- 其他校区：根据需要添加

## 球台管理方式

### 1. Django管理后台
访问地址：`http://localhost:8000/admin/`

**功能：**
- 查看所有球台列表
- 添加新球台
- 编辑球台信息（编号、名称、状态等）
- 删除球台
- 按校区筛选球台

**操作步骤：**
1. 登录管理后台
2. 点击「Reservations」→「Tables」
3. 可以查看、添加、编辑球台

### 2. 命令行管理

#### 查看球台分布
```bash
python manage.py shell -c "from reservations.models import Table; from campus.models import Campus; [print(f'{c.name}: {Table.objects.filter(campus=c).count()}个球台') for c in Campus.objects.all()]"
```

#### 为校区添加球台
```python
# 进入Django shell
python manage.py shell

# 添加球台的Python代码
from reservations.models import Table
from campus.models import Campus

# 获取校区
campus = Campus.objects.get(name='校区名称')

# 创建球台
for i in range(1, 6):  # 创建5个球台
    Table.objects.create(
        campus=campus,
        number=f'T{i:02d}',
        name=f'{campus.name}{i}号台',
        status='available'
    )
```

#### 批量创建球台脚本
```python
# 为所有校区创建球台
from reservations.models import Table
from campus.models import Campus

for campus in Campus.objects.all():
    existing_count = Table.objects.filter(campus=campus).count()
    if existing_count == 0:
        # 为没有球台的校区创建3个球台
        for i in range(1, 4):
            Table.objects.create(
                campus=campus,
                number=f'{campus.name[:2]}{i:02d}',
                name=f'{campus.name}{i}号台',
                status='available'
            )
        print(f'为 {campus.name} 创建了3个球台')
```

### 3. API接口管理

#### 查询可用球台
```
GET /api/reservations/tables/available/
参数：
- campus_id: 校区ID
- start_time: 开始时间 (YYYY-MM-DD HH:MM:SS)
- end_time: 结束时间 (YYYY-MM-DD HH:MM:SS)
```

#### 球台列表
```
GET /api/reservations/tables/
```

## 球台状态说明

- `available`: 可用
- `maintenance`: 维护中
- `disabled`: 已禁用

## 常见问题排查

### 1. "该时间段暂无可用球台"
**检查步骤：**
1. 确认选择的校区是否有球台
2. 检查球台状态是否为 `available`
3. 确认时间段是否有预约冲突
4. 检查球台的 `is_active` 字段

### 2. 球台不显示
**可能原因：**
- 球台状态不是 `available`
- 球台的 `is_active` 为 `False`
- 校区ID传递错误
- 时间格式不正确

### 3. 调试工具
使用项目中的调试脚本：
```bash
python debug_api_issue.py
```

或使用调试页面：
```
http://localhost:3000/test_table_debug.html
```

## 数据库结构

### Table模型字段
- `id`: 主键
- `campus`: 校区外键
- `number`: 球台编号
- `name`: 球台名称
- `status`: 状态 (available/maintenance/disabled)
- `description`: 描述
- `is_active`: 是否激活
- `created_at`: 创建时间
- `updated_at`: 更新时间

## 建议

1. **定期检查球台数据**：确保每个校区都有足够的球台
2. **合理分配球台**：根据校区规模和使用频率分配球台数量
3. **状态管理**：及时更新球台的维护状态
4. **监控使用情况**：通过预约数据分析球台使用率

---

*最后更新：2025年9月13日*