# 乒乓球培训管理系统设计文档

## 1. 系统架构设计

### 1.1 总体架构

```
┌─────────────────────────────────────────────────────────┐
│                    前端展示层                              │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐      │
│  │  管理员界面  │ │  教练员界面  │ │  学员界面    │      │
│  └─────────────┘ └─────────────┘ └─────────────┘      │
└─────────────────────────────────────────────────────────┘
                            │
                    HTTP/HTTPS 请求
                            │
┌─────────────────────────────────────────────────────────┐
│                   Web服务层                              │
│  ┌─────────────────────────────────────────────────────┐ │
│  │              Django Web Framework                   │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐  │ │
│  │  │ 用户管理 │ │ 课程管理 │ │ 支付管理 │ │ 比赛管理 │  │ │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘  │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
                            │
                      ORM映射
                            │
┌─────────────────────────────────────────────────────────┐
│                   数据持久层                              │
│  ┌─────────────────────────────────────────────────────┐ │
│  │                  MySQL数据库                        │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐  │ │
│  │  │ 用户表   │ │ 课程表   │ │ 支付表   │ │ 比赛表   │  │ │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘  │ │
│  └─────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────┘
```

### 1.2 技术架构

- **前端技术**：Vue 3 + Element Plus + Vite + Axios
- **后端框架**：Django 4.2.24 + Django REST Framework
- **数据库**：MySQL 8.0
- **Web服务器**：Django开发服务器（开发环境）
- **认证方式**：Token认证 + Session认证
- **跨域处理**：django-cors-headers

### 1.3 模块划分

#### 1.3.1 核心模块
- **用户认证模块**（accounts）
- **校区管理模块**（campus）
- **课程管理模块**（courses）
- **支付管理模块**（payments）
- **比赛管理模块**（competitions）
- **消息通知模块**（notifications）
- **系统日志模块**（logs）

#### 1.3.2 公共模块
- **权限控制模块**（permissions）
- **工具类模块**（utils）
- **配置管理模块**（settings）

## 2. UML设计图
见《UML图标设计.md》

## 3. 数据库设计

### 3.1 数据库概念模型（ER图）

```
用户(User) ──┐
            │
            ├── 学员(Student)
            ├── 教练员(Coach) 
            ├── 校区管理员(CampusAdmin)
            └── 超级管理员(SuperAdmin)
            │
            │ 1:N
            ▼
          校区(Campus)
            │
            │ 1:N
            ▼
        双选关系(CoachStudentRelation)
            │
            │ 1:N
            ▼
        课程预约(Booking)
            │
            │ 1:1
            ▼
        支付记录(Payment)
```

### 3.2 数据表设计
见《数据库设计.md》


## 3. 接口设计概要

### 3.1 接口设计原则
- **RESTful架构**：采用REST风格设计API接口
- **统一响应格式**：所有接口返回统一的JSON格式
- **Token认证**：使用Django Token进行用户身份验证
- **版本控制**：通过URL路径进行API版本管理

### 3.2 接口模块划分
- **认证模块**：用户登录、注册、令牌刷新
- **用户管理**：用户信息查询、更新、权限管理
- **课程管理**：课程查询、预约、取消
- **支付管理**：订单创建、支付处理、退款
- **系统管理**：通知、日志、统计分析

### 3.3 接口安全设计
- **Django Token认证**：保护需要认证的接口
- **权限控制**：基于角色的访问控制(RBAC)
- **参数验证**：严格的输入参数校验
- **频率限制**：防止接口滥用

*详细的API接口规范请参考《API接口文档.md》*

## 4. 安全设计

### 4.1 身份认证与授权
- Django Token认证机制
- 基于角色的权限控制(RBAC)
- 密码加密存储(Django PBKDF2)

### 4.2 数据安全
- 敏感数据加密传输(HTTPS)
- 数据库连接加密
- 用户隐私信息保护

### 4.3 网络安全
- CSRF防护（已实现）
- XSS攻击防护（Django模板系统提供）
- SQL注入防护（Django ORM提供）
- 请求频率限制（暂未实现）

## 7. 监控与日志

### 7.1 系统监控
- 服务器性能监控
- 数据库性能监控
- 应用程序监控

### 7.2 日志管理
- 访问日志
- 错误日志
- 操作日志
- 日志轮转策略

## 8. 技术栈选型

### 8.1 前端技术
- **基础技术**：HTML5, CSS3, JavaScript ES6+
- **UI框架**：Bootstrap 5
- **图表库**：Chart.js
- **日期选择**：Flatpickr
- **文件上传**：Dropzone.js
- **数据表格**：DataTables

### 8.2 后端技术
- **Web框架**：Django 4.2
- **数据库ORM**：Django ORM
- **API框架**：Django REST Framework
- **身份认证**：Django-allauth + Django Token
- **异步任务**：暂未实现（可考虑Celery + Redis）
- **缓存**：暂未配置（已安装Redis依赖）