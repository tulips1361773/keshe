# 乒乓球培训管理系统需求规格说明书

## 一、引言

### 1.1 项目背景

随着乒乓球运动的普及和全民健身理念的推广，乒乓球培训机构数量不断增加，规模和管理需求也日益多样化。传统的人工管理方式已无法满足现代培训机构的高效运营需求。蓝星软件公司计划开发一款基于Web的乒乓球培训管理系统，旨在通过信息化手段提升培训机构的管理效率，优化学员和教练的服务体验，实现培训业务的数字化转型。

### 1.3 文档范围

本文档涵盖：
- 乒乓球培训管理系统的所有功能需求和非功能需求
- 系统的外部接口需求和数据需求
- 系统的验收标准

### 1.4 术语定义

- **双选关系**：学员选择教练且教练确认接受后建立的师生关系
- **课时费**：学员预约课程需要支付的费用，根据教练级别和课程时长计算
- **月赛**：每月第四个星期天举办的乒乓球比赛
- **校区管理员**：负责管理特定校区日常运营的管理人员
- **超级管理员**：拥有系统最高权限，可管理所有校区的系统管理员

## 二、总体概述

### 2.1 产品概述

乒乓球培训管理系统是一个基于Web技术的综合性管理平台，采用B/S架构设计，为乒乓球培训机构、学员和教练员提供一站式数字化服务。系统支持多校区分布式管理，具备完整的用户权限体系，涵盖学员管理、教练管理、课程管理、赛事管理、财务管理等核心业务功能。

**系统特色：**
- 支持多校区统一管理和分权管理
- 实现学员与教练的双向选择机制
- 提供灵活的课程预约和取消机制
- 实现支付和财务管理功能
- 支持月赛报名和赛程自动安排
- 完善的消息通知和评价反馈体系

### 2.2 产品功能概述

#### 2.2.1 核心功能模块

**学员管理模块：**
- 学员注册与信息维护
- 教练员查询与双选申请
- 课程预约与取消管理
- 账户充值与费用支付
- 课表查询与上课提醒
- 教练更换申请
- 训练评价与反馈

**教练管理模块：**
- 教练注册与资质审核
- 学员申请审核处理
- 课程预约确认与拒绝
- 个人信息维护
- 训练评价与建议

**校区管理模块：**
- 校区信息录入与维护
- 学员信息管理
- 教练信息管理
- 课程预约信息管理
- 系统操作日志查询

**赛事管理模块：**
- 月赛报名与费用收取
- 赛程自动安排
- 比赛信息查询

**财务管理模块：**
- 学员账户充值（线上/线下）
- 课时费自动扣除
- 退费处理
- **财务报表统计**

#### 2.2.2 系统管理功能

- 用户权限管理
- 系统参数配置
- **数据备份与恢复**
- 系统监控与日志管理

### 2.3 用户角色定义

**超级管理员**
- 职责：负责整个乒校系统的全局管理
- 权限：校区信息管理、分校区负责人指定、全系统数据访问

**校区管理员**
- 职责：负责本校区的日常运营管理
- 权限：本校区学员、教练、课程预约等信息管理

**学员**
- 职责：通过系统完成学习相关的各项操作
- 权限：个人信息管理、教练选择、课程预约、费用支付等

**教练员**
- 职责：通过系统管理教学相关事务
- 权限：个人信息管理、学员申请审核、课程确认、评价反馈等


## 三、具体需求

### 3.1 功能需求

#### 3.1.1 系统管理

- **校区管理**
  - 超级管理员可以录入每个校区的基本信息，包括名字、地址、联系方式（联系人、电话、邮箱）等，并指定分校区的负责人。
  - 超级管理员缺省成为中心校区的校区管理员。
  - 任何普通校区管理员应用系统完成的对各自校区的管理工作，超级管理员均有权限操作。
- **用户管理**
  - 学员注册时需提供用户名、密码、真实姓名、性别、年龄、校区、电话和邮箱，其中用户名、密码、校区、姓名和电话是必须填写的信息，其他信息可空白。校区可以从系统提供的下拉列表中选择。密码设置要求 8 - 16 位，必须包含字母、数字和特殊字符。学员的注册无需后台审核。
  - 教练员注册时需提供用户名、密码、真实姓名、性别、年龄、校区、电话、邮箱、教练员照片及其以往比赛中取得的成绩描述，并且需要校区管理员审核通过，方可注册成功。教练员分为高级、中级和初级三种，不同的级别在注册时由校区管理员审核指定。
  - 学员和教练员均可对其基本信息进行维护，例如更换照片、修改密码等。

#### 3.1.2 学员功能

- **教练员查询**
  - 学员可以通过按照姓名查询和浏览所有教练员两种方式查询教练员。
  - 按照姓名查询时，学员需输入查询条件，包括教练员姓名，性别，年龄三个查询条件（查询条件至少填写一项），如果系统中有匹配的教练员，则显示该教练员的基本信息，包括教练的照片和获奖信息等。如果没有与查询条件相匹配的教练员，则提示没有找到相关教练员。如果有多名教练员满足查询条件，则应列出所有满足条件的教练员列表，学员点击后显示该教练员信息。
  - 浏览所有教练员时，系统列出该校区全部教练员列表，在用户点击某教练员链接时显示该教练员信息。
- **教练员选择**
  - 学员在查询教练员的基础上，可以选择该教练员成为其主管教练员，通过点击“选中教练”按钮，完成教练员的选择申请。
  - 教练员会在学员提交申请后收到系统消息，可以审核通过或不通过，如果教练员审核通过，则建立了双选关系，如果教练员审核不通过，则双选关系未建立，但系统会记录该项双选未成功的记录供后续查询。一名学员最多选择两位教练员，一名教练员可以指导最多 20 名学员。
- **课程预约**
  - 在双选关系确立后，学生可以预约课程。学生选择某个已建立双选关系的教练员，系统显示该教练员的课表，课表中列出该教练员未来一周的所有已预约的课程，包括哪一天的哪个时间段及球台编号，学生可以在课表中空白的时间段进行预约，此时系统会显示在该时间段未被占用的球台供学生选择，学生也可以选择由系统自动分配球台。
  - 教练员登录系统后，会看到预约消息，教练员可以确认预约，也可以拒绝预约。
  - 在预约成功后（教练员也确认了预约，并且支付成功），学员和教练员均可在预约上课时间之前的 24 小时及以上取消预约，预约取消需对方确认后，方能生效，此时系统会发起退费，将支付的本次课时费退回学员账户。无论是学员还是教练员，一个月内取消预约不可以超过三次，每次在提交取消申请时，系统均提示本月剩余的取消次数。在同一个月内第四次试图取消预约时，无法提交取消申请（提交按钮不可用）。
- **费用管理**
  - 学员可以通过系统的收费功能在账户中预存一定金额的训练费，系统提供线上支付方式，以及线下支付方式，若采用线上支付，系统进行简单的模拟即可，输入金额即可充值；若采用线下支付，需由校区管理员将训练费手工录入系统。
  - 每次学员预约课程，并得到教练员的确认后，系统根据教练员的每小时收费金额及训练时段的时长，计算此次预约的课时费，从学员的账户中扣除。如果账户中金额不足以支付课时费，系统将拒绝此次课程预约。
  - 如果学员或教练员对符合 24 小时规定的预订发起了取消预订，系统在双方确认的时刻，自动将相应的课时费退费至用户账户。
- **课表查询**
  - 学员可以随时查询课表，系统也会在上课前一小时通过系统消息提醒学员。
- **更换教练员**
  - 学员可以选择更换教练员，系统自动显示学员当前的教练员，并显示本校区教练员列表，由学员指定希望换成的教练员，系统会通过系统消息通知当前教练员、未来教练员及校区管理员，三者均同意后，才能对系统中存储的相关信息进行更新。
- **训练评价**
  - 每次训练课后，系统根据课程结束的时间，向学员发起一次评价请求，学员录入此次训练课的收获和教训。

#### 3.1.3 教练功能

- **注册审核**：教练员注册需要校区管理员审核通过，方可注册成功。校区管理员在审核时指定教练员的级别（高级、中级、初级）。
- **学员申请审核**：教练员收到学员的选择申请后，可以审核通过或不通过。
- **课程预约处理**：教练员登录系统后，查看学员的课程预约消息，可确认或拒绝预约。
- **信息维护**：教练员可对其基本信息进行维护，如更换照片、修改密码等。
- **训练评价**：每次训练课后，系统向教练员发起评价请求，教练员录入学生的表现和进一步提高的建议。

超级管理员可以管理所有校区的信息，同时超级管理员可以创建校区，并且创建校区的时候可以指定该校区的负责人（用户名和密码）。
#### 3.1.4 校区管理员功能

- **校区信息管理**：录入和管理校区的基本信息，包括校区名称、地址、联系方式等。
- **学员信息管理**：对本校区的学员信息进行添加、修改、删除和查询操作。操作时需以消息方式提醒相关人员。
- **教练信息管理**：对本校区的教练信息进行管理，包括添加、修改、删除和查询。修改时需输入教练员的身份证号码或手机号，系统验证数据格式和内容，验证成功后回到初始操作界面。操作需以消息方式提醒相关人员。
- **课程预约信息管理**：对本校区的课程预约信息进行管理，操作需以消息方式提醒相关人员。
- **系统日志查询**：随时查询系统中记录的所有用户的重要操作记录。

#### 3.1.5 赛事管理功能

- **月赛报名**：学员可通过系统报名参加每月第四个星期天的月赛，报名时需支付 30 元报名费，报名费从学员账户余额中扣除，余额不足时提醒学员充值。
- **赛程安排**：系统根据每组参赛学员人数进行赛程安排。若每组参赛学员不多于 6 人，采用组内全循环方式排场次，并随机分配球台；若多于 6 人，先将参赛学员分为更小的小组，在小组内采用全循环排场次，取小组前两名交叉淘汰。
- **比赛信息查询**：参赛球员可在系统中查看自己的比赛顺序及球台编号。

### 3.2 非功能需求

#### 3.2.1 性能需求

**响应时间要求：**
- 系统页面加载时间不超过5秒（在正常网络环境下）
- 数据查询响应时间不超过3秒
- 文件上传响应时间不超过10秒（单文件最大5MB）
- 支付处理响应时间不超过15秒

**并发性能要求：**
- 系统支持50-100个并发用户同时在线
- 在高峰期（如月赛报名）支持最多200个并发用户
- 数据库连接池支持20-50个并发连接

**容量需求：**
- 支持1,000-5,000名学员信息存储
- 支持100-500名教练员信息存储
- 支持10-50个校区信息管理
- 系统能存储6个月的历史数据
- 单个文件上传大小限制为5MB

**可用性要求：**
- 系统可用性目标达到95%以上
- 计划内维护时间每月不超过8小时
- 系统故障恢复时间目标4小时内

#### 3.2.2 安全需求

**身份认证与授权：**
- 用户密码采用Django默认的PBKDF2算法加密存储
- 实施基于角色的访问控制（RBAC）
- 支持会话超时机制，空闲30分钟自动登出
- 基础的登录失败限制（依赖Django内置机制）

**数据安全：**
- 敏感数据传输使用HTTPS协议（生产环境）
- Django内置的SQL注入防护机制
- Django内置的XSS攻击防护机制
- 基础的用户个人信息保护

**系统安全：**
- 基础的操作日志记录
- 重要操作提供确认提示
- 遵循Django安全最佳实践

**数据备份：**
- 支持数据库手动备份
- 建议定期进行数据备份
- 基础的数据恢复支持

#### 3.2.3 易用性需求

**界面设计：**
- 采用响应式设计，支持PC端和移动端访问
- 界面布局清晰，符合用户操作习惯
- 重要操作提供明确的视觉反馈
- 支持键盘快捷键操作

**用户体验：**
- 提供详细的操作帮助文档
- 重要操作提供操作向导
- 错误信息应清晰明确，并提供解决建议
- 支持操作撤销功能

#### 3.2.6 可维护性需求

**代码质量：**
- 代码遵循基本的编码规范
- 核心功能有基础的测试覆盖
- 重要代码有必要的注释

**系统监控：**
- 基础的系统运行日志记录
- 简单的错误日志收集
- 基础的性能监控（通过日志）

**文档要求：**
- 提供基础的系统部署文档
- 提供API接口文档
- 提供用户操作手册

## 四、外部接口需求

### 4.1 支付接口

**当前实现状态：**
- 已完成支付数据模型设计
- 已实现基础的支付流程框架
- 支持线下支付记录和管理
- 第三方支付接口集成待开发

**计划支持的支付方式：**
- 微信支付：计划支持扫码支付、H5支付
- 支付宝支付：计划支持扫码支付、网页支付
- 线下支付：现金、银行转账等

### 4.2 消息通知接口

**当前实现状态：**
- 已实现系统内消息通知模型
- 外部通知渠道集成待开发

**通知场景：**
- 课程预约确认/取消
- 教练申请审核结果
- 账户余额变动提醒
- 系统公告通知

### 4.3 文件存储接口

**接口描述：** 用户头像、教练资质证书等文件的存储和访问

**当前实现状态：**
- 已实现本地文件存储
- 支持基础的文件上传和访问
- 云存储集成待开发

**存储要求：**
- 支持图片格式：JPG、PNG、GIF
- 单文件大小限制：5MB
- 存储方式：本地文件系统存储
- 访问方式：HTTP直链访问

## 五、数据需求

### 5.1 数据实体详细定义

#### 5.1.1 用户相关实体

**学员实体（Student）**
- 学员ID（主键）：唯一标识符
- 用户名：8-20位字符，支持字母、数字、下划线
- 密码：8-16位，必须包含字母、数字和特殊字符
- 真实姓名：2-20位中文字符
- 性别：男/女/其他
- 年龄：6-80岁
- 校区ID：关联校区表
- 电话：11位手机号码
- 邮箱：标准邮箱格式
- 头像：图片文件路径
- 账户余额：精确到分的金额
- 注册时间：时间戳
- 最后登录时间：时间戳
- 账户状态：正常/冻结/注销

**教练员实体（Coach）**
- 教练ID（主键）：唯一标识符
- 用户名：8-20位字符
- 密码：加密存储
- 真实姓名：2-20位中文字符
- 性别：男/女/其他
- 年龄：18-65岁
- 校区ID：关联校区表
- 电话：11位手机号码
- 邮箱：标准邮箱格式
- 头像：图片文件路径
- 级别：高级/中级/初级
- 获奖信息：文本描述
- 每小时收费：根据级别设定
- 审核状态：待审核/已通过/已拒绝
- 注册时间：时间戳
- 账户状态：正常/冻结/注销

#### 5.1.2 业务相关实体

**校区实体（Campus）**
- 校区ID（主键）：唯一标识符
- 校区名称：2-50位字符
- 地址：详细地址信息
- 联系人：负责人姓名
- 联系电话：座机或手机号码
- 邮箱：校区联系邮箱
- 管理员ID：关联管理员用户
- 创建时间：时间戳
- 状态：正常/停用

**课程预约实体（Booking）**
- 预约ID（主键）：唯一标识符
- 学员ID：关联学员表
- 教练ID：关联教练表
- 预约日期：日期
- 开始时间：时间
- 结束时间：时间
- 球台编号：1-50号
- 课时费：本次课程费用
- 预约状态：待确认/已确认/已取消/已完成
- 创建时间：时间戳
- 确认时间：时间戳
- 取消时间：时间戳（如有）

**双选关系实体（CoachStudentRelation）**
- 关系ID（主键）：唯一标识符
- 学员ID：关联学员表
- 教练ID：关联教练表
- 申请时间：时间戳
- 审核时间：时间戳
- 关系状态：待审核/已建立/已拒绝/已解除
- 备注：文本信息

#### 5.1.3 财务相关实体

**账户充值记录（Recharge）**
- 充值ID（主键）：唯一标识符
- 学员ID：关联学员表
- 充值金额：精确到分
- 支付方式：线上/线下
- 支付渠道：微信/支付宝/银行卡/现金
- 交易流水号：第三方支付流水号
- 充值时间：时间戳
- 状态：成功/失败/处理中

**消费记录（Consumption）**
- 消费ID（主键）：唯一标识符
- 学员ID：关联学员表
- 预约ID：关联预约表（如适用）
- 消费类型：课时费/月赛报名费/其他
- 消费金额：精确到分
- 消费时间：时间戳
- 备注：消费说明

#### 5.1.4 赛事相关实体

**月赛实体（MonthlyMatch）**
- 赛事ID（主键）：唯一标识符
- 赛事名称：月赛标题
- 举办日期：每月第四个星期天
- 报名截止时间：时间戳
- 报名费：固定30元
- 赛事状态：报名中/已截止/进行中/已结束
- 创建时间：时间戳

**赛事报名实体（MatchRegistration）**
- 报名ID（主键）：唯一标识符
- 赛事ID：关联月赛表
- 学员ID：关联学员表
- 报名时间：时间戳
- 分组信息：A组/B组/C组等
- 报名状态：已报名/已取消

### 5.2 数据关系详细说明

#### 5.2.1 主要实体关系

**一对多关系：**
- 校区 ↔ 学员（一个校区有多个学员）
- 校区 ↔ 教练（一个校区有多个教练）
- 学员 ↔ 课程预约（一个学员可有多个预约）
- 教练 ↔ 课程预约（一个教练可有多个预约）
- 学员 ↔ 充值记录（一个学员可有多次充值）
- 学员 ↔ 消费记录（一个学员可有多次消费）

**多对多关系：**
- 学员 ↔ 教练（通过双选关系表实现，一个学员最多2个教练，一个教练最多20个学员）
- 学员 ↔ 月赛（通过报名表实现，一个学员可参加多个月赛）

#### 5.2.2 数据完整性约束

**主键约束：**
- 所有实体表都必须有唯一主键
- 主键采用自增整数或UUID

**外键约束：**
- 所有关联字段必须设置外键约束
- 删除操作需要考虑级联关系

**唯一性约束：**
- 用户名在全系统内唯一
- 手机号在全系统内唯一
- 邮箱在全系统内唯一

**检查约束：**
- 年龄必须在合理范围内
- 金额必须为非负数
- 电话号码必须符合格式要求
- 邮箱必须符合标准格式

### 5.3 数据存储要求

**数据库选型：**
- 主数据库：MySQL 8.0+ 或 PostgreSQL 12+
- 缓存数据库：Redis 6.0+
- 搜索引擎：Elasticsearch（可选）


## 六、验收标准

### 6.1 功能验收标准

#### 6.1.1 核心功能验收

**用户管理功能：**
- 学员注册成功率≥99%
- 教练审核流程完整无误
- 用户信息修改实时生效
- 密码安全策略有效执行

**课程管理功能：**
- 课程预约成功率≥95%
- 预约冲突检测准确率100%
- 课程取消流程符合业务规则
- 课表显示准确无误

**财务管理功能：**
- 支付成功率：基于第三方支付接口的实际表现（当前未集成）
- 账户余额计算准确率100%（已实现）
- 退费流程完整可靠（已实现基础退费逻辑）
- 财务报表数据准确（基础统计功能已实现）

**赛事管理功能：**
- 报名流程顺畅无阻（已实现）
- 赛程安排算法正确（已实现自动分组功能）
- 比赛信息显示准确（已实现）

#### 6.1.2 系统管理功能验收

**权限管理：**
- 角色权限控制准确率100%（已实现基础权限控制）
- 越权访问防护有效（已实现基础防护）
- 操作日志记录完整（已实现基础日志功能）

**数据管理：**
- 数据备份恢复：当前支持手动备份
- 数据导入导出功能：已实现基础的数据管理功能
- 数据完整性约束有效（已通过Django ORM实现）

### 7.3 安全验收标准

**身份安全：**
- 密码加密存储（已通过Django默认PBKDF2实现）
- 会话管理安全（已通过Django Session框架实现）
- 防暴力破解：已实现基础的登录限制

**数据安全：**
- 敏感数据传输加密：生产环境计划使用HTTPS
- SQL注入防护有效（已通过Django ORM实现）
- XSS攻击防护有效（已通过Django模板系统实现）

**系统安全：**
- 安全漏洞扫描：依赖Django框架的安全更新
- 操作日志完整（已实现基础日志记录）
- 权限控制严格（已实现基础权限控制）

### 7.4 易用性验收标准

**界面设计：**
- 界面布局合理美观
- 操作流程简洁明了
- 错误提示清晰准确
- 响应式设计适配良好

**用户体验：**
- 帮助文档：提供基础的用户手册
- 用户满意度：通过实际使用反馈评估

### 7.6 文档验收标准

**技术文档：**
- 系统架构文档：已提供基础的系统设计文档
- API接口文档：已通过Django REST Framework自动生成
- 部署运维文档：提供基础的部署指南
- 代码注释规范：核心功能有必要的注释

**用户文档：**
- 用户操作手册：提供基础的使用说明
- 管理员指南：提供后台管理操作指南
- 常见问题解答：基于实际使用中的问题整理
- 培训材料：提供基础的系统介绍材料

