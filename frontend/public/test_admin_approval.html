<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜å®¡æ ¸åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .info-box {
            background: #e8f4fd;
            border: 1px solid #3498db;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
        }
        .success {
            background: #d4edda;
            border-color: #27ae60;
            color: #155724;
        }
        .warning {
            background: #fff3cd;
            border-color: #f39c12;
            color: #856404;
        }
        .error {
            background: #f8d7da;
            border-color: #e74c3c;
            color: #721c24;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #3498db;
            background: #f8f9fa;
        }
        .step h3 {
            margin-top: 0;
            color: #2c3e50;
        }
        .link-button {
            display: inline-block;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
            transition: background 0.3s;
        }
        .link-button:hover {
            background: #2980b9;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .code {
            background: #f4f4f4;
            padding: 10px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .status-pending {
            color: #f39c12;
            font-weight: bold;
        }
        .status-approved {
            color: #27ae60;
            font-weight: bold;
        }
        .status-rejected {
            color: #e74c3c;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŠâ€â™‚ï¸ ç®¡ç†å‘˜å®¡æ ¸åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="info-box">
            <h3>ğŸ“‹ åŠŸèƒ½è¯´æ˜</h3>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ç®¡ç†å‘˜å¯¹æ•™ç»ƒæ³¨å†Œçš„å®¡æ ¸åŠŸèƒ½ã€‚åç«¯å·²å®ç°å®Œæ•´çš„å®¡æ ¸APIå’ŒDjangoç®¡ç†åå°ç•Œé¢ã€‚</p>
        </div>

        <h2>ğŸ”§ å·²å®ç°çš„åŠŸèƒ½</h2>
        
        <div class="step">
            <h3>1. åç«¯APIå®ç°</h3>
            <ul>
                <li>âœ… è·å–å¾…å®¡æ ¸æ•™ç»ƒåˆ—è¡¨API: <code>/accounts/api/pending-coaches/</code></li>
                <li>âœ… å®¡æ ¸æ•™ç»ƒAPI: <code>/accounts/api/approve-coach/{coach_id}/</code></li>
                <li>âœ… æƒé™æ§åˆ¶ï¼šåªæœ‰æ ¡åŒºç®¡ç†å‘˜å’Œè¶…çº§ç®¡ç†å‘˜å¯ä»¥å®¡æ ¸</li>
                <li>âœ… æ ¡åŒºé™åˆ¶ï¼šæ ¡åŒºç®¡ç†å‘˜åªèƒ½å®¡æ ¸æœ¬æ ¡åŒºæ•™ç»ƒ</li>
            </ul>
        </div>

        <div class="step">
            <h3>2. Djangoç®¡ç†åå°</h3>
            <ul>
                <li>âœ… Coachæ¨¡å‹å·²æ³¨å†Œåˆ°admin</li>
                <li>âœ… å®Œæ•´çš„ç®¡ç†ç•Œé¢ï¼ŒåŒ…å«åˆ—è¡¨ã€ç­›é€‰ã€æœç´¢åŠŸèƒ½</li>
                <li>âœ… æƒé™æ§åˆ¶å’Œæ ¡åŒºè¿‡æ»¤</li>
                <li>âœ… å®¡æ ¸æ—¶è‡ªåŠ¨è®¾ç½®å®¡æ ¸äººå’Œå®¡æ ¸æ—¶é—´</li>
                <li>âœ… å®¡æ ¸é€šè¿‡æ—¶è‡ªåŠ¨æ¿€æ´»ç”¨æˆ·è´¦æˆ·</li>
            </ul>
        </div>

        <div class="step">
            <h3>3. æµ‹è¯•æ•°æ®</h3>
            <table>
                <tr>
                    <th>è´¦æˆ·ç±»å‹</th>
                    <th>ç”¨æˆ·å</th>
                    <th>å¯†ç </th>
                    <th>è¯´æ˜</th>
                </tr>
                <tr>
                    <td>è¶…çº§ç®¡ç†å‘˜</td>
                    <td>admin</td>
                    <td>admin123</td>
                    <td>å¯ä»¥å®¡æ ¸æ‰€æœ‰æ•™ç»ƒ</td>
                </tr>
                <tr>
                    <td>æ ¡åŒºç®¡ç†å‘˜</td>
                    <td>campus_admin</td>
                    <td>admin123</td>
                    <td>åªèƒ½å®¡æ ¸æœ¬æ ¡åŒºæ•™ç»ƒ</td>
                </tr>
                <tr>
                    <td>å¾…å®¡æ ¸æ•™ç»ƒ</td>
                    <td>test_coach</td>
                    <td>coach123</td>
                    <td class="status-pending">çŠ¶æ€ï¼šå¾…å®¡æ ¸</td>
                </tr>
            </table>
        </div>

        <h2>ğŸ§ª æµ‹è¯•æ­¥éª¤</h2>
        
        <div class="step">
            <h3>æ­¥éª¤1ï¼šè®¿é—®Djangoç®¡ç†åå°</h3>
            <p>ç‚¹å‡»ä¸‹é¢çš„é“¾æ¥è®¿é—®ç®¡ç†åå°ï¼š</p>
            <a href="http://localhost:8000/admin" class="link-button" target="_blank">ğŸ”— Djangoç®¡ç†åå°</a>
        </div>

        <div class="step">
            <h3>æ­¥éª¤2ï¼šä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•</h3>
            <div class="code">
                ç”¨æˆ·å: admin<br>
                å¯†ç : admin123
            </div>
        </div>

        <div class="step">
            <h3>æ­¥éª¤3ï¼šæŸ¥çœ‹æ•™ç»ƒå‘˜ç®¡ç†</h3>
            <p>ç™»å½•åï¼Œåœ¨ç®¡ç†ç•Œé¢ä¸­æ‰¾åˆ° "ACCOUNTS" éƒ¨åˆ†ï¼Œç‚¹å‡» "æ•™ç»ƒå‘˜" è¿›å…¥æ•™ç»ƒå‘˜ç®¡ç†é¡µé¢ã€‚</p>
        </div>

        <div class="step">
            <h3>æ­¥éª¤4ï¼šå®¡æ ¸æ•™ç»ƒ</h3>
            <p>åœ¨æ•™ç»ƒå‘˜åˆ—è¡¨ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å¾…å®¡æ ¸çš„æ•™ç»ƒã€‚ç‚¹å‡»æ•™ç»ƒåç§°è¿›å…¥è¯¦æƒ…é¡µé¢ï¼Œä¿®æ”¹å®¡æ ¸çŠ¶æ€ï¼š</p>
            <ul>
                <li>å°† "å®¡æ ¸çŠ¶æ€" ä» "å¾…å®¡æ ¸" æ”¹ä¸º "å·²é€šè¿‡" æˆ– "å·²æ‹’ç»"</li>
                <li>å¯ä»¥åŒæ—¶ä¿®æ”¹ "æ•™ç»ƒçº§åˆ«"ï¼ˆåˆçº§/ä¸­çº§/é«˜çº§ï¼‰</li>
                <li>ä¿å­˜åç³»ç»Ÿä¼šè‡ªåŠ¨è®¾ç½®å®¡æ ¸äººå’Œå®¡æ ¸æ—¶é—´</li>
                <li>å¦‚æœå®¡æ ¸é€šè¿‡ï¼Œç”¨æˆ·è´¦æˆ·ä¼šè¢«è‡ªåŠ¨æ¿€æ´»</li>
            </ul>
        </div>

        <h2>ğŸ” APIæµ‹è¯•</h2>
        
        <div class="step">
            <h3>æµ‹è¯•å¾…å®¡æ ¸æ•™ç»ƒåˆ—è¡¨API</h3>
            <button onclick="testPendingCoaches()" class="link-button">æµ‹è¯•è·å–å¾…å®¡æ ¸æ•™ç»ƒ</button>
            <div id="pending-result" class="test-result"></div>
        </div>

        <div class="step">
            <h3>æµ‹è¯•å®¡æ ¸API</h3>
            <p>éœ€è¦å…ˆç™»å½•è·å–tokenï¼Œç„¶åæ‰èƒ½è°ƒç”¨å®¡æ ¸API</p>
            <button onclick="testLogin()" class="link-button">æµ‹è¯•ç®¡ç†å‘˜ç™»å½•</button>
            <div id="login-result" class="test-result"></div>
        </div>

        <h2>âœ… éªŒè¯ç»“æœ</h2>
        
        <div class="info-box success">
            <h3>åŠŸèƒ½å®Œæ•´æ€§æ£€æŸ¥</h3>
            <ul>
                <li>âœ… åç«¯APIå·²å®ç°å¹¶æµ‹è¯•é€šè¿‡</li>
                <li>âœ… Djangoç®¡ç†åå°å·²é…ç½®å®Œæˆ</li>
                <li>âœ… æƒé™æ§åˆ¶æ­£å¸¸å·¥ä½œ</li>
                <li>âœ… å®¡æ ¸æµç¨‹å®Œæ•´</li>
                <li>âœ… æµ‹è¯•æ•°æ®å·²å‡†å¤‡</li>
            </ul>
        </div>

        <div class="info-box warning">
            <h3>å‰ç«¯å®ç°çŠ¶æ€</h3>
            <p><strong>å‰ç«¯ç®¡ç†ç•Œé¢å°šæœªå®ç°</strong>ã€‚ç›®å‰ç®¡ç†å‘˜éœ€è¦é€šè¿‡Djangoè‡ªå¸¦çš„ç®¡ç†åå°è¿›è¡Œå®¡æ ¸æ“ä½œã€‚</p>
            <p>å¦‚éœ€å‰ç«¯ç®¡ç†ç•Œé¢ï¼Œéœ€è¦åœ¨Vue.jsé¡¹ç›®ä¸­æ·»åŠ ï¼š</p>
            <ul>
                <li>ç®¡ç†å‘˜ä¸“ç”¨çš„å®¡æ ¸é¡µé¢ç»„ä»¶</li>
                <li>å¾…å®¡æ ¸æ•™ç»ƒåˆ—è¡¨å±•ç¤º</li>
                <li>å®¡æ ¸æ“ä½œç•Œé¢</li>
                <li>æƒé™è·¯ç”±ä¿æŠ¤</li>
            </ul>
        </div>
    </div>

    <script>
        let authToken = null;

        async function testLogin() {
            const resultDiv = document.getElementById('login-result');
            resultDiv.innerHTML = 'æ­£åœ¨æµ‹è¯•ç™»å½•...';
            
            try {
                const response = await fetch('http://localhost:8000/accounts/api/login/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        username: 'campus_admin',
                        password: 'admin123'
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    authToken = data.token;
                    resultDiv.className = 'test-result success';
                    resultDiv.innerHTML = `
                        <h4>âœ… ç™»å½•æˆåŠŸ</h4>
                        <p>ç”¨æˆ·: ${data.user.real_name} (${data.user.user_type})</p>
                        <p>Tokenå·²è·å–ï¼Œå¯ä»¥è¿›è¡ŒAPIæµ‹è¯•</p>
                        <button onclick="testApproveCoach()" class="link-button">æµ‹è¯•å®¡æ ¸API</button>
                    `;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.innerHTML = `<h4>âŒ ç™»å½•å¤±è´¥</h4><p>${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>âŒ è¯·æ±‚å¤±è´¥</h4><p>${error.message}</p>`;
            }
        }

        async function testPendingCoaches() {
            const resultDiv = document.getElementById('pending-result');
            resultDiv.innerHTML = 'æ­£åœ¨è·å–å¾…å®¡æ ¸æ•™ç»ƒ...';
            
            try {
                const response = await fetch('http://localhost:8000/accounts/api/pending-coaches/');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.className = 'test-result success';
                    let html = '<h4>âœ… è·å–æˆåŠŸ</h4>';
                    
                    if (data.coaches && data.coaches.length > 0) {
                        html += '<table><tr><th>å§“å</th><th>ç”¨æˆ·å</th><th>çº§åˆ«</th><th>çŠ¶æ€</th><th>åˆ›å»ºæ—¶é—´</th></tr>';
                        data.coaches.forEach(coach => {
                            html += `<tr>
                                <td>${coach.user.real_name}</td>
                                <td>${coach.user.username}</td>
                                <td>${coach.coach_level}</td>
                                <td class="status-${coach.status}">${coach.status}</td>
                                <td>${new Date(coach.created_at).toLocaleString()}</td>
                            </tr>`;
                        });
                        html += '</table>';
                    } else {
                        html += '<p>æš‚æ— å¾…å®¡æ ¸æ•™ç»ƒ</p>';
                    }
                    
                    resultDiv.innerHTML = html;
                } else {
                    resultDiv.className = 'test-result error';
                    resultDiv.innerHTML = `<h4>âŒ è·å–å¤±è´¥</h4><p>${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.className = 'test-result error';
                resultDiv.innerHTML = `<h4>âŒ è¯·æ±‚å¤±è´¥</h4><p>${error.message}</p>`;
            }
        }

        async function testApproveCoach() {
            if (!authToken) {
                alert('è¯·å…ˆç™»å½•è·å–token');
                return;
            }

            const resultDiv = document.getElementById('login-result');
            
            try {
                // å…ˆè·å–å¾…å®¡æ ¸æ•™ç»ƒID
                const pendingResponse = await fetch('http://localhost:8000/accounts/api/pending-coaches/');
                const pendingData = await pendingResponse.json();
                
                if (pendingData.success && pendingData.coaches.length > 0) {
                    const coachId = pendingData.coaches[0].id;
                    
                    // æµ‹è¯•å®¡æ ¸API
                    const approveResponse = await fetch(`http://localhost:8000/accounts/api/approve-coach/${coachId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            status: 'approved',
                            coach_level: 'intermediate'
                        })
                    });
                    
                    const approveData = await approveResponse.json();
                    
                    if (approveData.success) {
                        resultDiv.innerHTML += `
                            <div class="test-result success">
                                <h4>âœ… å®¡æ ¸æˆåŠŸ</h4>
                                <p>æ•™ç»ƒ ${approveData.coach.user.real_name} å·²å®¡æ ¸é€šè¿‡</p>
                                <p>çº§åˆ«: ${approveData.coach.coach_level}</p>
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML += `
                            <div class="test-result error">
                                <h4>âŒ å®¡æ ¸å¤±è´¥</h4>
                                <p>${approveData.message}</p>
                            </div>
                        `;
                    }
                } else {
                    resultDiv.innerHTML += `
                        <div class="test-result warning">
                            <h4>âš ï¸ æ— å¾…å®¡æ ¸æ•™ç»ƒ</h4>
                            <p>å½“å‰æ²¡æœ‰å¾…å®¡æ ¸çš„æ•™ç»ƒ</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML += `
                    <div class="test-result error">
                        <h4>âŒ å®¡æ ¸æµ‹è¯•å¤±è´¥</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•å¾…å®¡æ ¸æ•™ç»ƒåˆ—è¡¨
        window.onload = function() {
            testPendingCoaches();
        };
    </script>
</body>
</html>