# 羽毛球比赛管理系统 - 部署和使用说明

## 系统概述

羽毛球比赛管理系统是一个基于Django的Web应用，提供完整的比赛管理、用户管理、支付系统和管理后台功能。

## 环境要求

### 系统要求
- **操作系统**: Windows/Linux/macOS
- **Python**: 3.8+
- **数据库**: MySQL 5.7+
- **内存**: 最低2GB，推荐4GB+
- **存储**: 最低10GB可用空间

### 依赖软件
- Python 3.8+
- MySQL数据库
- pip包管理器

## 部署步骤

### 1. 环境准备

```bash
# 克隆项目（如果从版本控制获取）
git clone <repository-url>
cd keshe

# 创建虚拟环境
python -m venv venv

# 激活虚拟环境
# Windows:
venv\Scripts\activate
# Linux/macOS:
source venv/bin/activate
```

### 2. 安装依赖

```bash
# 安装Python依赖
pip install -r requirements.txt

# 如果没有requirements.txt，手动安装核心依赖：
pip install django
pip install mysqlclient
pip install djangorestframework
pip install django-cors-headers
```

### 3. 数据库配置

```bash
# 创建MySQL数据库
mysql -u root -p
CREATE DATABASE badminton_competition CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
CREATE USER 'badminton_user'@'localhost' IDENTIFIED BY 'your_password';
GRANT ALL PRIVILEGES ON badminton_competition.* TO 'badminton_user'@'localhost';
FLUSH PRIVILEGES;
EXIT;
```

### 4. 项目配置

编辑 `settings.py` 文件，配置数据库连接：

```python
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': 'badminton_competition',
        'USER': 'badminton_user',
        'PASSWORD': 'your_password',
        'HOST': 'localhost',
        'PORT': '3306',
    }
}
```

### 5. 数据库迁移

```bash
# 生成迁移文件
python manage.py makemigrations

# 执行迁移
python manage.py migrate

# 创建超级用户
python manage.py createsuperuser
```

### 6. 启动服务

```bash
# 开发环境启动
python manage.py runserver

# 生产环境启动（使用gunicorn）
pip install gunicorn
gunicorn keshe.wsgi:application --bind 0.0.0.0:8000
```

## 系统使用说明

### 管理员使用

#### 1. 访问管理后台
- URL: `http://localhost:8000/admin/`
- 使用超级用户账号登录

#### 2. 基础数据管理
1. **校区管理**: 创建和管理校区信息
2. **用户管理**: 管理学生、教练、管理员账户
3. **比赛管理**: 创建和管理比赛信息

#### 3. 比赛管理流程
1. 创建比赛（设置报名费、时间等）
2. 学生在线报名和支付
3. 系统自动分组和排赛程
4. 录入比赛结果
5. 查看统计报告

### 普通用户使用

#### 1. 用户注册和登录
- 注册账户并选择用户类型
- 完善个人信息和校区信息

#### 2. 比赛报名
1. 浏览可报名的比赛
2. 选择比赛并支付报名费
3. 查看个人赛程安排

#### 3. 账户管理
- 充值账户余额
- 查看交易记录
- 更新个人信息

## API接口说明

### 认证接口
```
POST /api/accounts/login/          # 用户登录
POST /api/accounts/register/       # 用户注册
PUT  /api/accounts/profile/update/ # 更新用户信息
```

### 比赛接口
```
GET  /api/competitions/            # 获取比赛列表
POST /api/competitions/register/   # 比赛报名
GET  /api/competitions/{id}/       # 获取比赛详情
```

### 支付接口
```
POST /api/payments/recharge/       # 账户充值
GET  /api/payments/transactions/   # 交易记录
```

## 系统维护

### 日常维护
1. **数据备份**: 定期备份MySQL数据库
2. **日志监控**: 检查Django日志文件
3. **性能监控**: 监控系统响应时间和资源使用

### 数据备份
```bash
# 备份数据库
mysqldump -u badminton_user -p badminton_competition > backup_$(date +%Y%m%d).sql

# 恢复数据库
mysql -u badminton_user -p badminton_competition < backup_20240101.sql
```

### 日志管理
```bash
# 查看Django日志
tail -f logs/django.log

# 查看访问日志
tail -f logs/access.log
```

## 故障排除

### 常见问题

#### 1. 数据库连接失败
- 检查MySQL服务是否启动
- 验证数据库配置信息
- 确认用户权限设置

#### 2. 静态文件无法加载
```bash
# 收集静态文件
python manage.py collectstatic
```

#### 3. 迁移失败
```bash
# 重置迁移
python manage.py migrate --fake-initial
```

#### 4. 端口占用
```bash
# Windows查看端口占用
netstat -ano | findstr :8000

# Linux查看端口占用
lsof -i :8000
```

## 安全建议

### 生产环境配置
1. **DEBUG模式**: 设置 `DEBUG = False`
2. **SECRET_KEY**: 使用强密码并保密
3. **ALLOWED_HOSTS**: 配置允许的主机名
4. **HTTPS**: 启用SSL证书
5. **防火墙**: 配置适当的防火墙规则

### 数据安全
1. 定期更新依赖包
2. 使用强密码策略
3. 定期备份数据
4. 监控异常访问

## 技术支持

### 联系方式
- 技术文档: 查看项目docs目录
- 问题反馈: 通过项目issue系统

### 开发环境
- 开发服务器: `python manage.py runserver`
- 测试命令: `python manage.py test`
- 数据库shell: `python manage.py dbshell`

---

**文档版本**: 1.0
**更新时间**: 2024年
**适用版本**: Django 4.x